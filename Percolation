import java.util.*;

public class Percolation {
    public int width;
    public int area;
    public boolean board[];
    WeightedQuickUnion weightedQuickUnion;

    public Percolation(int width) {
        this.width = width;
        area = width * width;
    }

    public double simulate() {
        board = new boolean[area];
        weightedQuickUnion = new WeightedQuickUnion(width);

        int opened = 0;
        int site;

        while (!weightedQuickUnion.connected(0, area - 1)) {
            Random random = new Random();
            site = random.nextInt(area);

            if (!board[site]) {
                open(site);
                opened += 1;
            }
        }

        return (double) opened / area;
    }

    public void open(int site) {
        int[] adjacents = new int[] {site + 1, site - 1, site - width, site + width};
        int neighbor;
        int x;

        for (int direction = 0; direction < 4; direction++) {
            neighbor = adjacents[direction];
            x = site % width;
            if (!(direction == 0 && x == width - 1)
                    && !(direction == 1 && x == 0)
                    && !(direction == 2 && site < width)
                    && !(direction == 3 && site >= area - width)
                    && board[neighbor]) {
                weightedQuickUnion.union(site, neighbor);
            }
        }

        board[site] = true;
    }

    public String toString() {
        String[] output = new String[this.width];
        int[] temporary;

        for (int row = 0; row < this.width; row++) {
            temporary = new int[this.width];
            for (int column = 0; column < this.width; column++) {
                temporary[column] = this.board[column + (row * this.width)] ? 1 : 0;
            }
            output[row] = Arrays.toString(temporary) + "\n";
        }
        return " " + Arrays.toString(output);
    }
}
